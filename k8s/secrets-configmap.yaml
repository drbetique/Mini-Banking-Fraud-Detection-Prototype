# Kubernetes Secrets and ConfigMaps
# WARNING: Base64 encoding is NOT encryption!
# Use Kubernetes Secrets Manager, HashiCorp Vault, or AWS Secrets Manager in production

---
# ==================== SECRETS ====================
apiVersion: v1
kind: Secret
metadata:
  name: fraud-detection-secrets
  namespace: fraud-detection
type: Opaque
stringData:
  # Database connection
  database-url: "postgresql://user:CHANGE_THIS_PASSWORD@postgres-service:5432/bankdb"

  # API authentication
  api-key: "CHANGE_THIS_TO_SECURE_RANDOM_KEY"

  # Redis password (if using authentication)
  redis-password: ""

  # Slack webhook (for notifications)
  slack-webhook-url: "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"

  # SMTP credentials (for email notifications)
  smtp-username: "your-email@gmail.com"
  smtp-password: "your-app-password"

---
# ==================== IMAGE PULL SECRET ====================
# For private container registries (GitHub Container Registry)
# Create this using:
# kubectl create secret docker-registry ghcr-secret \
#   --docker-server=ghcr.io \
#   --docker-username=YOUR_GITHUB_USERNAME \
#   --docker-password=YOUR_GITHUB_TOKEN \
#   --namespace=fraud-detection

---
# ==================== CONFIGMAP ====================
apiVersion: v1
kind: ConfigMap
metadata:
  name: fraud-detection-config
  namespace: fraud-detection
data:
  # Application configuration
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"

  # Kafka configuration
  KAFKA_TOPIC: "transactions_topic"
  KAFKA_GROUP_ID: "fraud-detectors"

  # Cache configuration
  CACHE_TTL_ANOMALIES: "60"
  CACHE_TTL_SHORT: "30"
  REDIS_POOL_SIZE: "20"

  # Alert thresholds
  HIGH_RISK_THRESHOLD: "0.8"
  CRITICAL_RISK_THRESHOLD: "0.9"
  HIGH_VALUE_THRESHOLD: "5000.0"

  # Email configuration
  SMTP_SERVER: "smtp.gmail.com"
  SMTP_PORT: "587"
  EMAIL_FROM: "fraud-alerts@company.com"
  EMAIL_TO: "security-team@company.com"

  # Prometheus metrics
  PROMETHEUS_PORT: "8001"

  # CORS configuration
  FRONTEND_ORIGIN: "https://fraud-dashboard.example.com"

---
# ==================== SERVICE ACCOUNT ====================
apiVersion: v1
kind: ServiceAccount
metadata:
  name: fraud-detection-sa
  namespace: fraud-detection
automountServiceAccountToken: true

---
# ==================== ROLE (for accessing secrets) ====================
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: fraud-detection-role
  namespace: fraud-detection
rules:
  - apiGroups: [""]
    resources: ["secrets", "configmaps"]
    verbs: ["get", "list", "watch"]

---
# ==================== ROLE BINDING ====================
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: fraud-detection-rolebinding
  namespace: fraud-detection
subjects:
  - kind: ServiceAccount
    name: fraud-detection-sa
    namespace: fraud-detection
roleRef:
  kind: Role
  name: fraud-detection-role
  apiGroup: rbac.authorization.k8s.io
